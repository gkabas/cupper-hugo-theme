const yourCustomFunction01 = (message) => {
  console.log(message);
};

// This function turns off all buttons at the beginning
function initializeDisplay() {
  const ids = [
    "abs1", "pdf1", "pres1", "pdf-navigation1",
    "abs2", "pdf2", "pres2", "pdf-navigation2",
    "abs3", "pdf3", "pres3", "pdf-navigation3",
    "abs4", "pdf4", "pres4", "pdf-navigation4",
    "abs5", "pdf5", "pres5", "pdf-navigation5",
    "abs6", "pdf6", "pres6", "pdf-navigation6",
    "abs7", "pdf7", "pres7", "pdf-navigation7",
  ];

  ids.forEach((id) => {
    const element = document.getElementById(id);
    if (element) {
      element.style.display = "none";
    }
  });
}

// Call initializeDisplay when the page loads and queue Main Results preloading
window.addEventListener("load", () => {
  initializeDisplay();
  schedulePdfPreload();
});


function pdf1() {
    window.open("https://gkabas.netlify.app/files/BenincasaKabasOngena.pdf", "_blank");
    }

function ssrn1() {
    window.open("https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4075737", "_blank");
    }

function pdf2() {
    window.open("https://gkabas.netlify.app/files/KabasRoszbach.pdf", "_blank");
    }

function ssrn2() {
    window.open("https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3835232", "_blank");
    }

function pdf3() {
    window.open("https://gkabas.netlify.app/files/ArslanDegerliKabas.pdf", "_blank");
    }

function ssrn3() {
    window.open("https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3280437", "_blank");
    }
@@ -353,890 +356,381 @@ function pres6() {
    presContainer.style.display = "block";
    pdfContainer.style.display = "none";
    absContainer.style.display = "none";
    navContainer.style.display = "none"; // Hide navigation buttons
  }
}

function pres7() {
  const presContainer = document.getElementById("pres7");
  const pdfContainer = document.getElementById("pdf7");
  const absContainer = document.getElementById("abs7");
  const navContainer = document.getElementById("pdf-navigation7");

  // Toggle Abstract visibility
  if (presContainer.style.display === "block") {
    presContainer.style.display = "none";
  } else {
    presContainer.style.display = "block";
    pdfContainer.style.display = "none";
    absContainer.style.display = "none";
    navContainer.style.display = "none"; // Hide navigation buttons
  }
}

//////////////////////////////////////////////////////////////
// Main Results PDF viewer helpers
//////////////////////////////////////////////////////////////

const pdfViewerConfigs = [
  {
    key: 1,
    url: "https://gazikabas.netlify.app/files/BKO.pdf",
    containerId: "pdf1",
    navId: "pdf-navigation1",
    absId: "abs1",
    presId: "pres1",
  },
  {
    key: 2,
    url: "https://gazikabas.netlify.app/files/KR.pdf",
    containerId: "pdf2",
    navId: "pdf-navigation2",
    absId: "abs2",
    presId: "pres2",
  },
  {
    key: 3,
    url: "https://gazikabas.netlify.app/files/ADK.pdf",
    containerId: "pdf3",
    navId: "pdf-navigation3",
    absId: "abs3",
    presId: "pres3",
  },
  {
    key: 4,
    url: "https://gazikabas.netlify.app/files/DKO.pdf",
    containerId: "pdf4",
    navId: "pdf-navigation4",
    absId: "abs4",
    presId: "pres4",
  },
  {
    key: 5,
    url: "https://gazikabas.netlify.app/files/ADGKK.pdf",
    containerId: "pdf5",
    navId: "pdf-navigation5",
    absId: "abs5",
    presId: "pres5",
  },
  {
    key: 7,
    url: "https://gazikabas.netlify.app/files/ETS_2.pdf",
    containerId: "pdf7",
    navId: "pdf-navigation7",
    absId: "abs7",
    presId: "pres7",
  },
];

const pdfConfigMap = {};
const pdfViewerState = {};

pdfViewerConfigs.forEach((config) => {
  pdfConfigMap[config.key] = config;
  pdfViewerState[config.key] = {
    pageNum: 1,
    pageCount: 0,
    pdfDoc: null,
    loadingPromise: null,
  };
});

function getPdfElements(config) {
  return {
    pdfContainer: document.getElementById(config.containerId),
    navContainer: document.getElementById(config.navId),
    absContainer: document.getElementById(config.absId),
    presContainer: document.getElementById(config.presId),
  };
}

function getEffectiveContainerWidth(container) {
  if (!container) {
    return 0;
  }

  const visibleWidth = container.getBoundingClientRect().width;
  if (visibleWidth > 0) {
    return visibleWidth;
  }

  if (container.parentElement) {
    const parentWidth = container.parentElement.getBoundingClientRect().width;
    if (parentWidth > 0) {
      return parentWidth;
    }
  }

  return Math.min(Math.max(window.innerWidth || 800, 320), 1200);
}

function ensurePdfLoaded(key) {
  const config = pdfConfigMap[key];
  const state = pdfViewerState[key];
  if (!config || !state) {
    return Promise.resolve(null);
  }

  const { pdfContainer } = getPdfElements(config);
  if (!pdfContainer) {
    return Promise.resolve(null);
  }

  if (state.pdfDoc) {
    return Promise.resolve(state.pdfDoc);
  }

  if (!state.loadingPromise) {
    const isVisible = window.getComputedStyle(pdfContainer).display !== "none";
    if (isVisible) {
      pdfContainer.innerHTML = "<p>Loading figuresâ€¦</p>";
    }

    state.loadingPromise = pdfjsLib
      .getDocument(config.url)
      .promise.then((pdf) => {
        state.pdfDoc = pdf;
        state.pageCount = pdf.numPages;
        return pdf;
      })
      .catch((error) => {
        console.error(`Error loading PDF for paper ${key}:`, error);
        pdfContainer.innerHTML = "<p>Unable to load PDF. Please check the file URL.</p>";
        state.loadingPromise = null;
        throw error;
      });
  }

  return state.loadingPromise;
}

function renderPdfPage(key) {
  const config = pdfConfigMap[key];
  const state = pdfViewerState[key];
  if (!config || !state || !state.pdfDoc) {
    return Promise.resolve();
  }

  const { pdfContainer } = getPdfElements(config);
  if (!pdfContainer) {
    return Promise.resolve();
  }

  const safePageNum = Math.min(Math.max(state.pageNum, 1), state.pageCount || 1);
  state.pageNum = safePageNum;

  return state.pdfDoc
    .getPage(state.pageNum)
    .then((page) => {
      const canvas = document.createElement("canvas");
      const context = canvas.getContext("2d");
      const containerWidth = getEffectiveContainerWidth(pdfContainer) || 800;
      const viewport = page.getViewport({ scale: 1 });
      const scale = containerWidth / viewport.width;
      const devicePixelRatio = window.devicePixelRatio || 1;
      const scaledViewport = page.getViewport({ scale });
      canvas.width = scaledViewport.width * devicePixelRatio;
      canvas.height = scaledViewport.height * devicePixelRatio;
      canvas.style.width = `${scaledViewport.width}px`;
      canvas.style.height = `${scaledViewport.height}px`;
      context.scale(devicePixelRatio, devicePixelRatio);
      pdfContainer.innerHTML = "";
      pdfContainer.appendChild(canvas);

      const renderContext = {
        canvasContext: context,
        viewport: scaledViewport,
      };

      return page.render(renderContext).promise;
    })
    .catch((error) => {
      console.error(`Error rendering PDF page for paper ${key}:`, error);
      pdfContainer.innerHTML = "<p>Error rendering this page.</p>";
    });
}

function togglePdfVisibility(key) {
  const config = pdfConfigMap[key];
  if (!config) {
    return;
  }

  const { pdfContainer, navContainer, absContainer, presContainer } = getPdfElements(config);
  if (!pdfContainer) {
    return;
  }

  const isVisible = window.getComputedStyle(pdfContainer).display !== "none";

  if (isVisible) {
    pdfContainer.style.display = "none";
    if (navContainer) {
      navContainer.style.display = "none";
    }
    return;
  }

  pdfContainer.style.display = "block";
  if (navContainer) {
    navContainer.style.display = "flex";
  }
  if (absContainer) {
    absContainer.style.display = "none";
  }
  if (presContainer) {
    presContainer.style.display = "none";
  }

  ensurePdfLoaded(key).then(() => {
    renderPdfPage(key);
  });
}

function changePdfSlide(key, delta) {
  const state = pdfViewerState[key];
  if (!state) {
    return;
  }

  ensurePdfLoaded(key).then(() => {
    if (!state.pdfDoc) {
      return;
    }

    const targetPage = state.pageNum + delta;
    if (targetPage < 1 || targetPage > state.pageCount) {
      return;
    }

    state.pageNum = targetPage;
    renderPdfPage(key);
  });
}

function schedulePdfPreload() {
  const startPreload = () => {
    pdfViewerConfigs.forEach((config, index) => {
      const { pdfContainer } = getPdfElements(config);
      if (!pdfContainer) {
        return;
      }

      setTimeout(() => {
        ensurePdfLoaded(config.key).catch(() => {});
      }, index * 300);
    });
  };

  if ("requestIdleCallback" in window) {
    requestIdleCallback(startPreload, { timeout: 2000 });
  } else {
    setTimeout(startPreload, 1200);
  }
}

function showPDFWithSlides1() {
  togglePdfVisibility(1);
}

function nextSlide1() {
  changePdfSlide(1, 1);
}

function prevSlide1() {
  changePdfSlide(1, -1);
}

function showPDFWithSlides2() {
  togglePdfVisibility(2);
}

function nextSlide2() {
  changePdfSlide(2, 1);
}

function prevSlide2() {
  changePdfSlide(2, -1);
}

function showPDFWithSlides3() {
  togglePdfVisibility(3);
}

function nextSlide3() {
  changePdfSlide(3, 1);
}

function prevSlide3() {
  changePdfSlide(3, -1);
}

function showPDFWithSlides4() {
  togglePdfVisibility(4);
}

function nextSlide4() {
  changePdfSlide(4, 1);
}

function prevSlide4() {
  changePdfSlide(4, -1);
}

function showPDFWithSlides5() {
  togglePdfVisibility(5);
}

function nextSlide5() {
  changePdfSlide(5, 1);
}

function prevSlide5() {
  changePdfSlide(5, -1);
}

function showPDFWithSlides7() {
  togglePdfVisibility(7);
}

function nextSlide7() {
  changePdfSlide(7, 1);
}

function prevSlide7() {
  changePdfSlide(7, -1);
}


function updateButtonText() {
  const buttons = [
    {
      id: "main-results-fig1",
      smallText: "Abs.",
      largeText: "Abstract",
    },
     {
      id: "main-results-fig2",
      smallText: "Abs.",
      largeText: "Abstract",
    },
     {
      id: "main-results-fig3",
      smallText: "Abs.",
      largeText: "Abstract",
    },
     {
      id: "main-results-fig4",
      smallText: "Abs.",
      largeText: "Abstract",
    },
